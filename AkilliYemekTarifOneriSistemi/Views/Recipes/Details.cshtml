@model AkilliYemekTarifOneriSistemi.Models.Recipe

@{
    ViewData["Title"] = Model.Title;
}

<!-- ================= HEADER ================= -->
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="fw-bold">@Model.Title</h1>

    @if (User.Identity?.IsAuthenticated == true)
    {
        if (ViewBag.IsFavorite == true)
        {
            <form asp-action="RemoveFavorite"
                  method="post"
                  asp-route-id="@Model.Id">
                @Html.AntiForgeryToken()
                <button class="btn btn-outline-danger rounded-pill">
                    ‚ù§Ô∏è Favoriden √áƒ±kar
                </button>
            </form>
        }
        else
        {
            <form asp-action="AddFavorite"
                  method="post"
                  asp-route-id="@Model.Id">
                @Html.AntiForgeryToken()
                <button class="btn btn-danger rounded-pill">
                    ‚ù§Ô∏è Favorilere Ekle
                </button>
            </form>
        }
    }
</div>

<!-- ================= IMAGE ================= -->
@if (!string.IsNullOrEmpty(Model.ImageUrl))
{
    <img src="@Model.ImageUrl"
         class="img-fluid rounded-4 shadow mb-4"
         style="max-height:420px;object-fit:cover;width:100%;" />
}

<!-- ================= META ================= -->
<div class="mb-4">
    <span class="badge bg-dark fs-6 me-2">
        ‚è±Ô∏è @Model.CookingTime dk
    </span>
</div>

<p class="lead">
    @Model.Description
</p>

<hr />

<!-- ================= INGREDIENTS ================= -->
<h3 class="mb-3">üßÇ Malzemeler</h3>

<table class="table table-hover align-middle">
    <thead class="table-light">
        <tr>
            <th>Malzeme</th>
            <th>Miktar</th>
            <th>Gram</th>
            <th>Kalori</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.RecipeIngredients)
        {
            var ingredientCalories =
            Model.NutritionFacts != null && Model.RecipeIngredients.Sum(x => x.CalculatedGrams) > 0
            ? Model.NutritionFacts.Calories
            * (item.CalculatedGrams / Model.RecipeIngredients.Sum(x => x.CalculatedGrams))
            : 0;

            <tr>
                <td class="fw-semibold">@item.Ingredient.Name</td>
                <td>@item.Quantity @item.Unit</td>
                <td>@Math.Round(item.CalculatedGrams, 1) g</td>
                <td>@Math.Round(ingredientCalories, 1) kcal</td>
            </tr>
        }
    </tbody>
</table>

<!-- ================= NUTRITION CARDS ================= -->
@if (Model.NutritionFacts != null)
{
    <hr />
    <h3 class="mb-4">üìä Toplam Besin Deƒüerleri</h3>

    <div class="row g-3 text-center">

        <div class="col-md-2 col-6">
            <div class="card shadow-sm rounded-4">
                <div class="card-body">
                    <div class="fs-4">üî•</div>
                    <strong>@Math.Round(Model.NutritionFacts.Calories, 0)</strong>
                    <div class="text-muted small">Kalori (kcal)</div>
                </div>
            </div>
        </div>

        <div class="col-md-2 col-6">
            <div class="card shadow-sm rounded-4">
                <div class="card-body">
                    <div class="fs-4">ü•©</div>
                    <strong>@Math.Round(Model.NutritionFacts.Protein, 1)</strong>
                    <div class="text-muted small">Protein (g)</div>
                </div>
            </div>
        </div>

        <div class="col-md-2 col-6">
            <div class="card shadow-sm rounded-4">
                <div class="card-body">
                    <div class="fs-4">üßà</div>
                    <strong>@Math.Round(Model.NutritionFacts.Fat, 1)</strong>
                    <div class="text-muted small">Yaƒü (g)</div>
                </div>
            </div>
        </div>

        <div class="col-md-2 col-6">
            <div class="card shadow-sm rounded-4">
                <div class="card-body">
                    <div class="fs-4">üçû</div>
                    <strong>@Math.Round(Model.NutritionFacts.Carbs, 1)</strong>
                    <div class="text-muted small">Karbonhidrat (g)</div>
                </div>
            </div>
        </div>

        <div class="col-md-2 col-6">
            <div class="card shadow-sm rounded-4">
                <div class="card-body">
                    <div class="fs-4">üç¨</div>
                    <strong>@Math.Round(Model.NutritionFacts.Sugar, 1)</strong>
                    <div class="text-muted small">≈ûeker (g)</div>
                </div>
            </div>
        </div>

        <div class="col-md-2 col-6">
            <div class="card shadow-sm rounded-4">
                <div class="card-body">
                    <div class="fs-4">üåæ</div>
                    <strong>@Math.Round(Model.NutritionFacts.Fiber, 1)</strong>
                    <div class="text-muted small">Lif (g)</div>
                </div>
            </div>
        </div>

    </div>
}
