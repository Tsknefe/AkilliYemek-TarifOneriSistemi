@model List<AkilliYemekTarifOneriSistemi.Models.Recipe>

@{
    ViewData["Title"] = "Tarifler";
    var q = Context.Request.Query["q"].ToString();
}

<style>
    .search-wrapper {
        max-width: 560px;
        margin: 0 auto 36px auto;
    }

    .search-box {
        position: relative;
    }

        .search-box input {
            border-radius: 999px;
            padding: 14px 52px 14px 20px;
            font-size: 1rem;
            border: 1px solid #ddd;
        }

        .search-box button {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            border-radius: 999px;
            padding: 8px 18px;
        }

    .recipe-card {
        border: none;
        border-radius: 20px;
        overflow: hidden;
        transition: transform .25s ease, box-shadow .25s ease;
        background: #fff;
    }

        .recipe-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 40px rgba(0,0,0,.12);
        }

    .recipe-img {
        height: 220px;
        object-fit: cover;
        width: 100%;
    }

    .badge-soft {
        background: rgba(0,0,0,.65);
        color: #fff;
        padding: 6px 12px;
        border-radius: 999px;
        font-size: 13px;
    }

    .recipe-meta {
        font-size: 13px;
        color: #6c757d;
        display: flex;
        flex-wrap: wrap;
        gap: 14px;
        margin-bottom: 10px;
    }

    .recipe-info {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 10px 12px;
        font-size: 13px;
        color: #555;
        margin-bottom: 14px;
        min-height: 56px;
    }
</style>

<div class="search-wrapper">
    <form method="get">
        <div class="search-box shadow-sm">
            <input type="text"
                   name="q"
                   value="@q"
                   class="form-control"
                   placeholder="Tarif ara (makarna, tavuk, sebze...)">
            <button type="submit" class="btn btn-outline-secondary">
                üîç
            </button>
        </div>
    </form>
</div>

@if (User.Identity?.IsAuthenticated == true && User.IsInRole("Admin"))
{
    <div class="d-flex justify-content-center justify-content-md-end gap-2 mb-3">
        <a asp-controller="AdminRecipes"
           asp-action="Create"
           class="btn btn-success rounded-pill px-4">
             Tarif Ekle
        </a>

        <a asp-controller="AdminRecipes"
           asp-action="Index"
           class="btn btn-outline-danger rounded-pill px-4">
            Admin Panel
        </a>
    </div>
}

<h2 class="mb-4 fw-bold text-center">Tarifler</h2>

<div class="row g-4">

    @if (!Model.Any())
    {
        <p class="text-muted text-center">Tarif bulunamadƒ±.</p>
    }
    else
    {
        foreach (var r in Model)
        {
            <div class="col-lg-4 col-md-6">
                <div class="card recipe-card h-100 shadow-sm">

                    <div class="position-relative">
                        <img src="@(!string.IsNullOrEmpty(r.ImageUrl)
                                      ? r.ImageUrl
                                      : "https://via.placeholder.com/400x300")"
                             class="recipe-img" />

                        @if (r.CookingTime > 0)
                        {
                            <div class="position-absolute top-0 end-0 m-3 badge-soft">
                                 @r.CookingTime dk
                            </div>
                        }
                    </div>

                    <div class="card-body d-flex flex-column">

                        <h5 class="fw-bold">@r.Title</h5>

                        <div class="recipe-meta">
                            <span> @(r.Servings > 0 ? r.Servings + " ki≈üilik" : "Ki≈üi ?")</span>
                            <span> @(string.IsNullOrEmpty(r.DietType) ? "Standart" : r.DietType)</span>
                        </div>

                        <div class="recipe-info">
                            @(string.IsNullOrEmpty(r.Description)
                                ? "Pratik, dengeli ve g√ºnl√ºk t√ºketime uygun bir tarif."
                                : (r.Description.Length > 90
                                ? r.Description.Substring(0, 90) + "..."
                                : r.Description))
                        </div>

                        <a asp-action="Details"
                           asp-route-id="@r.Id"
                           class="btn btn-outline-dark w-100 rounded-pill mt-auto">
                            Detaylarƒ± G√∂r
                        </a>

                    </div>
                </div>
            </div>
        }
    }

</div>
